var clientShipmentId,clientOrderId,uiScript=document.createElement("script");uiScript.src="//code.jquery.com/ui/1.12.1/jquery-ui.js",document.getElementsByTagName("head")[0].appendChild(uiScript);var link=document.createElement("link");link.href=click2shipJSHost+"/css/style.css?x="+Math.random(),link.rel="stylesheet",document.getElementsByTagName("head")[0].appendChild(link);var dialog,filteredArr1,apiHostconfig={apihost:"/",cdnHost:""},generateLabelURL=apiHostconfig.apihost+"resource/order/cbt/shipment",downloadLabelURL=apiHostconfig.apihost+"resource/order/cbt/shippingDocument";function createDialog(){var e=document.createElement("div");e.className="popup";e.innerHTML='<form id="shipment-form" method="post" action="">\n    <div class="upper-bar">\n     <p class="Box-info">Box Info </p>\n     <p id="selected_items_count"></p>\n     <button id="close-form-button" class="modal-cross icon-wm-close-noborder" />\n    </div>\n    <div id="productImage" class="image-container"></div>\n    <div id="fieldset-parent">\n    <fieldset  id="boxinfo-fieldset">  \n      <div class="container container-fluid-outer c2sContainer">\n        <div class="row">\n            <div class="col-sm-3">     \n              <label class="cbt-required box-fields-label" for="BoxDim">Box Dimensions Unit</label>  \n            <br />    \n             <select name="BoxDim" id="BoxDimUnit" class="box-fields-input" >\n                <option selected name="BoxDim" value="CM" class="box-fields-input">CM</option>\n                <option name="BoxDim" value="IN" class="box-fields-input">IN</option>\n             </select>        \n            </div>    \n            <div class="col-sm-3">     \n             <label class="cbt-required box-fields-label" for="BoxLength">Box Length </label>\n            <br />    \n             <input type="number" name="BoxLength" id="BoxLength" class="box-fields-input" min="0.01" step="0.01" required />      \n            </div> \n            <div class="col-sm-3">     \n             <label class="cbt-required box-fields-label" for="BoxWidth">Box Width </label>\n            <br />    \n             <input type="number" name="BoxWidth" id="BoxWidth" class="box-fields-input" min="0.01" step="0.01" required />   \n            </div>  \n            <div class="col-sm-3">     \n             <label class="cbt-required box-fields-label" for="BoxHeight">Box Height </label>\n            <br />    \n             <input type="number" name="BoxHeight" id="BoxHeight" class="box-fields-input" min="0.01" step="0.01" required /> \n            </div>          \n        </div>  \n      </div>        \n      <br>\n       <div class="container container-fluid-outer c2sContainer">\n        <div class="row">\n            <div class="col-sm-3">     \n             <label class="cbt-required box-fields-label" for="BoxWeightUnit">Box Weight Unit</label>\n            <br />    \n             <select name="BoxWeightUnit" id="BoxWeightUnit" class="box-fields-input">\n              <option selected name="BoxWeightUnit" value="LB" class="box-fields-input">LB</option>\n              <option name="BoxWeightUnit" value="OZ" class="box-fields-input">OZ</option>\n              <option name="BoxWeightUnit" value="KG" class="box-fields-input">KG</option>\n              <option name="BoxWeightUnit" value="GM" class="box-fields-input">GM</option>\n             </select>      \n            </div>    \n            <div class="col-sm-3">     \n             <label class="cbt-required box-fields-label" for="BoxWeight">Box Weight </label>\n            <br />    \n             <input type="number" name="BoxWeight" id="BoxWeight" class="box-fields-input" min="0.01" step="0.01" required />   \n            </div>                \n        </div>   \n       </div>\n        \n     </fieldset>\n    <fieldset id="address-fieldset">\n        <legend>Pickup Address : </legend>\n        <div class="container container-fluid-outer c2sContainer">\n         <div class="row">\n           <div class="col-sm-6">     \n            <label class="cbt-required address-fields-label" for="ContactName">Contact Name </label>\n           <br />    \n            <input type="text" name="ContactName" id="ContactName" class="address-fields-input" placeholder="Contact Name" required />  \n           </div>    \n           <div class="col-sm-6">     \n            <label class="cbt-required address-fields-label" for="CompanyName">Company Name </label>\n           <br />    \n            <input type="text" name="CompanyName" id="CompanyName" class="address-fields-input" placeholder="Company Name" required />\n           </div>                \n         </div>\n        </div>             \n        <br>    \n        <div class="container container-fluid-outer c2sContainer">\n         <div class="row">\n           <div class="col-sm-6">     \n             <label class="cbt-required address-fields-label" for="Address1">Address line 1 </label>\n           <br />    \n            <input type="text" name="Address1" id="Address1" class="address-fields-input" placeholder="Address line 1" required />\n           </div>    \n           <div class="col-sm-6">     \n            <label class="address-fields-label" for="Address2">Address line 2 </label>\n           <br />    \n            <input type="text" name="Address2" id="Address2" class="address-fields-input" placeholder="Address line 2" />\n           </div>                \n         </div>     \n        </div>    \n        <br>\n        <div class="container container-fluid-outer c2sContainer">\n         <div class="row">\n           <div class="col-sm-6">     \n             <label class="cbt-required address-fields-label" for="City">City </label>\n           <br />    \n            <input type="text" name="City" id="City" class="address-fields-input" placeholder="City" required />\n           </div>    \n           <div class="col-sm-6">     \n            <label class="cbt-required address-fields-label" for="ZipCode">ZipCode </label>\n           <br />    \n            <input type="text" name="ZipCode" id="ZipCode" class="address-fields-input" placeholder="ZipCode" required />\n           </div>                \n         </div>\n        </div>              \n        <br>\n        <div class="container container-fluid-outer c2sContainer">\n         <div class="row">\n           <div class="col-sm-6">     \n            <label class="cbt-required  address-fields-label" for="State">State </label>\n           <br />    \n            <input type="text" name="State" id="State" class="address-fields-input" placeholder="State" required />\n           </div>    \n           <div class="col-sm-6">     \n            <label class="cbt-required  address-fields-label" for="Country">Country </label>\n           <br />    \n            <input type="text" name="Country" id="Country" class="address-fields-input" placeholder="Country" required />\n           </div>                \n         </div>\n        </div>           \n        <br>\n        <div class="container container-fluid-outer c2sContainer">\n         <div class="row">\n           <div class="col-sm-6">     \n            <label class="cbt-required  address-fields-label" for="Phone">Phone </label>\n           <br />    \n            <input type="text" name="Phone" id="Phone" class="address-fields-input" placeholder="Phone" required />\n           </div>    \n           <div class="col-sm-6">     \n            <label class="address-fields-label" for="TaxId">TaxId</label>\n           <br />    \n            <input type="text" name="TaxId" id="TaxId" class="address-fields-input" placeholder="TaxId"/>\n           </div>                \n         </div>\n        </div>      \n        <br>\n    </fieldset>\n    </div>\n    \n    <div class="bottom-bar">\n        <div class="row">\n            <div class="col-sm-6">\n                <p id="api-response"></p>\n            </div>\n            <div class="col-sm-6 submit-btn-group">\n                <button id="generate-labels-button" class="wm-btn-primary">Generate Label</button>\n                <button id="download-document-button" class="wm-btn-primary disabled">Download Label</button>\n            </div>\n        </div>\n    </div>\n    \n    </form>\n    ',document.getElementsByTagName("body")[0].insertBefore(e,document.getElementsByTagName("body")[0].firstChild),dialog=$(".popup").dialog({autoOpen:!1,height:"auto",width:"auto",modal:!0,position:{my:"center",at:"center",of:window},button:!1,closeOnEscape:!0,open:function(e,n){$(".wm-modal-fp").addClass("gray-out")}}),$("#generate-labels-button").click(function(e){$("#api-response").text("").removeAttr("style"),filteredArr1=JSON.parse(localStorage.getItem("filteredArr")),console.log("retrived value from storage:",filteredArr1),$("#download-document-button").addClass("disabled"),createShipment(e)});var n=async e=>{result=[],e.preventDefault(),dialog.dialog("destroy").remove(),$(".wm-modal-fp").removeClass("gray-out")};document.getElementById("close-form-button").addEventListener("click",n),$(document).on("keydown",function(e){"Escape"==e.key&&n(e)})}function createShipment(e){if(!$("#shipment-form")[0].checkValidity())return console.log("validation errors"),!1;console.log("create shipment called");var n='\n        <div id="shipment-form-spinner">\n        </div>';$(".popup").append(n),$("#shipment-form :input").prop("disabled",!0),$("#shipment-form").css("opacity",.5);var i=[];filteredArr1.forEach(function(e,n,t){var s={sku:e.sku};i.push(s)});var t={boxInfo:[{boxDimUom:$("#BoxDimUnit").val(),boxHeight:$("#BoxHeight").val(),boxItems:i,boxWeight:$("#BoxWeight").val(),boxWeightUom:$("#BoxWeightUnit").val(),boxWidth:$("#BoxWidth").val(),boxlength:$("#BoxLength").val()}],consignorAddress:{address1:$("#Address1").val(),address2:$("#Address2").val(),city:$("#City").val(),companyName:$("#CompanyName").val(),contactName:$("#ContactName").val(),country:$("#Country").val(),phone:$("#Phone").val(),state:$("#State").val(),taxId:$("#TaxId").val(),zipCode:$("#ZipCode").val()},documentFormat:"PDF",insured:!1,insuredAmount:0,pickupAddress:{address1:$("#Address1").val(),address2:$("#Address2").val(),city:$("#City").val(),companyName:$("#CompanyName").val(),contactName:$("#ContactName").val(),country:$("#Country").val(),phone:$("#Phone").val(),state:$("#State").val(),taxId:$("#TaxId").val(),zipCode:$("#ZipCode").val()},providerId:1,providerOrderNumber:"",clientOrderId:document.getElementsByClassName("wm-pono")[0].innerText.substring(4),qtyBoxes:1,shippingMethod:"STANDARD"};e.preventDefault(),console.log("data:",t),$.ajax({type:"POST",enctype:"multipart/form-data",url:generateLabelURL,data:JSON.stringify(t),processData:!1,contentType:!1,cache:!1,headers:{"Content-Type":"application/json","wm.bu_id":"1","wm.mart_id":"1","wm.seller_id":"10000014100",Accept:"application/json"},timeout:1e4,success:function(e){console.log("SUCCESS : ",e.data),clientShipmentId=e.data.clientShipmentId,clientOrderId=e.data.clientOrderId,setTimeout(function(){$.ajax({url:downloadLabelURL+"?clientShipmentId="+clientShipmentId+"&documentType=label&Accept=application/json",timeout:1e4,success:function(e){console.log("resp :"+e),console.log("resp data :"+e.data),e.data&&e.data.base64?($("#api-response").text("Label is generated. Please click Download Label to proceed."),$("#shipment-form :input").prop("disabled",!1),$("#download-document-button").off("click").on("click",function(e){e.preventDefault(),$(".popup").append(n),$("#shipment-form :input").prop("disabled",!0),$("#shipment-form").css("opacity",.5),$.ajax({url:downloadLabelURL+"?clientShipmentId="+clientShipmentId+"&documentType=label&Accept=application/pdf",timeout:1e4,success:function(e){console.log("resp :"+e);var n=new Blob([e]),i=document.createElement("a");i.href=window.URL.createObjectURL(n),i.download=clientOrderId+"_"+clientShipmentId+"_Label.pdf",i.click(),$("#shipment-form-spinner").remove(),$("#shipment-form :input").prop("disabled",!1),$("#shipment-form").css("opacity",1)},error:function(e){console.log("ERROR : ",e),$("#shipment-form-spinner").remove(),$("#api-response").css("color","red"),$("#shipment-form :input").prop("disabled",!1),$("#shipment-form").css("opacity",1),$("#api-response").text("There was an error downloading the label. Please try again later.")}})}),$("#download-document-button").removeClass("disabled"),$("#shipment-form-spinner").remove(),$("#shipment-form").css("opacity",1)):(console.log("resp erros :"+e.errors),$("#api-response").css("color","red"),$("#api-response").text("There was an error generating the label. Please try again later.")),$("#shipment-form-spinner").remove(),$("#shipment-form :input").prop("disabled",!1),$("#shipment-form").css("opacity",1)},error:function(e){showError(e)}})},2e4)},error:function(e){showError(e)}})}function showError(e){console.log("ERROR : ",e),$("#shipment-form-spinner").remove(),$("#api-response").css("color","red"),$("#shipment-form :input").prop("disabled",!1),$("#shipment-form").css("opacity",1),$("#api-response").text("There was an error generating the label. Please try again later.")}
